<div class="layout-container">
  <!-- Enhanced Sidebar with Profile Submenu -->
  <div class="sidebar" [class.open]="sidebarOpen">
    <div class="sidebar-header">
      <h2>Resource Hub</h2>
    </div>

    <nav class="sidebar-nav">
      <!-- Profile Menu with Submenu (Only for RESOURCE users) -->
      <div *ngIf="currentUser?.role === Role.RESOURCE" class="nav-section">
        <a
          *ngIf="currentUser?.role === Role.RESOURCE"
          routerLink="/resource/dashboard"
          class="nav-item"
          routerLinkActive="active"
          (click)="onNavItemClick()"
        >
          <span class="nav-icon">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
              <polyline points="9,22 9,12 15,12 15,22" />
            </svg>
          </span>
          <span class="nav-text">Resource Dashboard</span>
        </a>
        <a
          *ngIf="currentUser?.role === Role.RESOURCE"
          routerLink="/about"
          routerLinkActive="active"
          class="nav-item"
          (click)="onNavItemClick()"
        >
          <span class="nav-icon">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
              <polyline points="9,22 9,12 15,12 15,22" />
            </svg>
          </span>
          <span class="nav-text">About</span>
        </a>
        <div
          class="nav-item nav-expandable"
          [class.active]="profileExpanded"
          (click)="toggleProfileMenu()"
        >
          <span class="nav-icon">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
          </span>
          <span class="nav-text">Profile</span>
          <span class="nav-chevron" [class.expanded]="profileExpanded">
            <svg
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="9,18 15,12 9,6" />
            </svg>
          </span>
        </div>

        <div class="nav-submenu" [class.expanded]="profileExpanded">
          <a
            routerLink="/profile/view"
            class="nav-subitem"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
            (click)="onNavItemClick()"
          >
            <span class="nav-subtext">View Profile</span>
          </a>
          <a
            [routerLink]="['/profile/complete']"
            [queryParams]="{ section: 'personal' }"
            class="nav-subitem"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: false }"
            (click)="onNavItemClick()"
          >
            <span class="nav-subtext">Personal Details</span>
          </a>
          <a
            [routerLink]="['/profile/complete']"
            [queryParams]="{ section: 'education' }"
            class="nav-subitem"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: false }"
            (click)="onNavItemClick()"
          >
            <span class="nav-subtext">Education</span>
          </a>
          <a
            [routerLink]="['/profile/complete']"
            [queryParams]="{ section: 'employment' }"
            class="nav-subitem"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: false }"
            (click)="onNavItemClick()"
          >
            <span class="nav-subtext">Employment</span>
          </a>
        </div>
      </div>

      <!-- Apply for Leave -->
      <a
        *ngIf="currentUser?.role === Role.RESOURCE"
        routerLink="/leave/apply"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
            <line x1="16" y1="2" x2="16" y2="6" />
            <line x1="8" y1="2" x2="8" y2="6" />
            <line x1="3" y1="10" x2="21" y2="10" />
          </svg>
        </span>
        <span class="nav-text">Apply for Leave</span>
      </a>
      <a
        *ngIf="currentUser?.role === Role.RESOURCE"
        routerLink="/resource/projects"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
        </svg>
        </span>
        <span class="nav-text">Projects</span>
      </a>

      <!-- Manager Dashboard (Manager only) -->
      <a
        *ngIf="currentUser?.role === Role.MANAGER"
        routerLink="/manager/dashboard"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
           <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 2L3 7v7c0 5 4 9 9 9s9-4 9-9V7l-9-5z" />
          </svg>
        </span>
        <span class="nav-text">Manager Dashboard</span>
      </a>
      <a
        *ngIf="currentUser?.role === Role.MANAGER"
        routerLink="/manager/leave-approvals"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
            />
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
          </svg>
        </span>
        <span class="nav-text">Leave Approval</span>
      </a>
      <a
        *ngIf="currentUser?.role === Role.MANAGER"
        routerLink="/manager/leave-management"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
            />
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
          </svg>
        </span>
        <span class="nav-text">Leave Management</span>
      </a>
      <a
        *ngIf="currentUser?.role === Role.MANAGER"
        routerLink="/manager/leave/calendar"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
            />
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
          </svg>
        </span>
        <span class="nav-text">Leave Calendar</span>
      </a>
      <a
        *ngIf="currentUser?.role === Role.MANAGER"
        routerLink="/manager/projects"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
        </svg>
        </span>
        <span class="nav-text">Projects</span>
      </a>
      <!-- Admin Dashboard (Admin only) -->
      <a
        *ngIf="currentUser?.role === Role.ADMIN"
        routerLink="/admin/dashboard"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M12 2L3 7v7c0 5 4 9 9 9s9-4 9-9V7l-9-5z" />
          </svg>
        </span>
        <span class="nav-text">Admin Dashboard</span>
      </a>

      <!-- User Management (Admin only) -->
      <a
        *ngIf="currentUser?.role === Role.ADMIN"
        routerLink="/admin/users"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
            <circle cx="9" cy="7" r="4" />
            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
          </svg>
        </span>
        <span class="nav-text">User Management</span>
      </a>
      <a
        *ngIf="currentUser?.role === Role.ADMIN"
        routerLink="/leave/calendar"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
            />
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
          </svg>
        </span>
        <span class="nav-text">Leave Calendar</span>
      </a>
      <a
        *ngIf="currentUser?.role === Role.ADMIN"
        routerLink="/admin/projects"
        class="nav-item"
        routerLinkActive="active"
        (click)="onNavItemClick()"
      >
        <span class="nav-icon">
          <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
        </svg>
        </span>
        <span class="nav-text">Projects</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
          <polyline points="16,17 21,12 16,7" />
          <line x1="21" y1="12" x2="9" y2="12" />
        </svg>
        Sign Out
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="header">
      <button class="menu-toggle" (click)="toggleSidebar()">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="3" y1="6" x2="21" y2="6" />
          <line x1="3" y1="12" x2="21" y2="12" />
          <line x1="3" y1="18" x2="21" y2="18" />
        </svg>
      </button>

      <h1>{{ getPageTitle() }}</h1>

      <div class="user-info">
        <div class="user-details">
          <p class="user-name">
            {{ currentUser?.firstName }} {{ currentUser?.lastName }}
          </p>
          <p class="user-role">{{ currentUser?.role }}</p>
        </div>
      </div>
    </div>

    <div class="page-content">
      <router-outlet></router-outlet>
    </div>
  </div>

  <!-- Mobile Overlay -->
  <div
    class="overlay"
    *ngIf="sidebarOpen"
    (click)="onOverlayClick()"
    [style.display]="sidebarOpen ? 'block' : 'none'"
  ></div>
</div>
