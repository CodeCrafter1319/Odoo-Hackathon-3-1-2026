<div class="rd-container">
  <!-- Header -->
  <div class="rd-header">
    <div>
      <button class="btn-back" (click)="goBack()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Back to Project
      </button>
      <h1>Manage Team Resources</h1>
      <p class="header-subtitle" *ngIf="project">{{ project.ProjectName }} ({{ project.ProjectCode }})</p>
    </div>
    
    <button class="btn btn-primary" (click)="openAddModal()">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <line x1="23" y1="11" x2="17" y2="11"></line>
        <line x1="20" y1="8" x2="20" y2="14"></line>
      </svg>
      Add Resource
    </button>
  </div>

  <!-- Alert Messages -->
  <div *ngIf="error" class="alert error">
    <span>{{ error }}</span>
    <button (click)="dismissError()" class="alert-close">×</button>
  </div>

  <div *ngIf="successMessage" class="alert success">
    <span>{{ successMessage }}</span>
    <button (click)="dismissSuccess()" class="alert-close">×</button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading resources...</p>
  </div>

  <!-- Resources List -->
  <div *ngIf="!loading" class="resources-card">
    <div class="card-header-row">
      <h2>Team Members</h2>
      <span class="count-badge">{{ resources.length }} members</span>
    </div>

    <div class="resources-grid" *ngIf="resources.length > 0">
      <div *ngFor="let resource of resources" class="resource-card">
        <div class="resource-header">
          <div class="resource-avatar">
            {{ resource.ResourceName.charAt(0) }}
          </div>
          <div class="resource-info">
            <h3 class="resource-name">{{ resource.ResourceName }}</h3>
            <p class="resource-email">{{ resource.ResourceEmail }}</p>
            <p class="resource-system-role">{{ resource.ResourceRole }}</p>
          </div>
        </div>

        <div class="resource-details">
          <div class="detail-row">
            <span class="detail-label">Project Role</span>
            <span class="detail-value">{{ resource.Role || 'Not specified' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Allocation</span>
            <span class="detail-value allocation-badge">{{ resource.AllocationPercentage }}%</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Assigned Date</span>
            <span class="detail-value">{{ formatDate(resource.AssignedDate) }}</span>
          </div>
          <div class="detail-row" *ngIf="resource.StartDate">
            <span class="detail-label">Start Date</span>
            <span class="detail-value">{{ formatDate(resource.StartDate) }}</span>
          </div>
          <div class="detail-row" *ngIf="resource.EndDate">
            <span class="detail-label">End Date</span>
            <span class="detail-value">{{ formatDate(resource.EndDate) }}</span>
          </div>
          <div class="detail-row" *ngIf="resource.Notes">
            <span class="detail-label">Notes</span>
            <span class="detail-value">{{ resource.Notes }}</span>
          </div>
        </div>

        <div class="resource-footer">
          <button class="btn-remove" (click)="openRemoveModal(resource)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Remove from Project
          </button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="resources.length === 0">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
      <p>No team members assigned yet</p>
      <button class="btn btn-primary" (click)="openAddModal()">Add First Member</button>
    </div>
  </div>

  <!-- Add Resource Modal -->
  <div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add Resource to Project</h2>
        <button class="modal-close" (click)="closeAddModal()">×</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="resource-select">Select Resource *</label>
          <select 
            id="resource-select" 
            class="form-control"
            [(ngModel)]="newAssignment.userId"
            (change)="onResourceSelect($event)"
            required>
            <option value="0">-- Select a resource --</option>
            <option *ngFor="let resource of availableResources" [value]="resource.Id">
              {{ resource.Name }} ({{ resource.Email }}) - {{ resource.CurrentProjectsCount }} projects
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="role">Project Role</label>
          <input 
            type="text" 
            id="role"
            class="form-control"
            [(ngModel)]="newAssignment.role"
            placeholder="e.g., Frontend Developer, Backend Developer">
        </div>

        <div class="form-group">
          <label for="allocation">Allocation Percentage *</label>
          <input 
            type="number" 
            id="allocation"
            class="form-control"
            [(ngModel)]="newAssignment.allocationPercentage"
            min="1"
            max="100"
            required>
          <small>Enter percentage (1-100). 100% means full-time</small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="start-date">Start Date</label>
            <input 
              type="date" 
              id="start-date"
              class="form-control"
              [(ngModel)]="newAssignment.startDate">
          </div>

          <div class="form-group">
            <label for="end-date">End Date</label>
            <input 
              type="date" 
              id="end-date"
              class="form-control"
              [(ngModel)]="newAssignment.endDate">
          </div>
        </div>

        <div class="form-group">
          <label for="notes">Notes</label>
          <textarea 
            id="notes"
            class="form-control"
            [(ngModel)]="newAssignment.notes"
            rows="3"
            placeholder="Additional notes about this assignment"></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-outline" (click)="closeAddModal()">Cancel</button>
        <button class="btn btn-primary" (click)="assignResource()">Assign Resource</button>
      </div>
    </div>
  </div>

  <!-- Remove Resource Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showRemoveModal" (click)="closeRemoveModal()">
    <div class="modal-content modal-sm" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Confirm Removal</h2>
        <button class="modal-close" (click)="closeRemoveModal()">×</button>
      </div>

      <div class="modal-body">
        <p>Are you sure you want to remove <strong>{{ resourceToRemove?.ResourceName }}</strong> from this project?</p>
        <p class="warning-text">This action cannot be undone.</p>
      </div>

      <div class="modal-footer">
        <button class="btn btn-outline" (click)="closeRemoveModal()">Cancel</button>
        <button class="btn btn-danger" (click)="confirmRemoveResource()">Remove Resource</button>
      </div>
    </div>
  </div>
</div>
